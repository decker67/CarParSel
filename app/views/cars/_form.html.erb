<%= form_for(@car, html: { class: 'form-horizontal' }) do |f| %>
  <% if @car.errors.any? %>
    <div id="error_explanation">
      <h2>Bitte korrigieren Sie die Eingabe:</h2>
      <ul>
      <% @car.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group">
    <%= f.label :seller_id, 'Verkäufer', class: 'col-md-3' %>
    <%= f.collection_select :seller_id, Seller.order('last_name ASC'), :id, :last_name %>
  </div>
  <div class="form-group">
    <%= f.label :price, 'Preis', class: 'col-md-3' %>
    <%= f.text_field :price %>
  </div>
  <div class="form-group">
    <%= f.label :car_identifier, 'Identifikation', class: 'col-md-3' %>
    <%= f.text_field :car_identifier %>
  </div>
  <div class="form-group">
    <%= f.label :brand_id, 'Hersteller', class: 'col-md-3' %>
    <%= select_tag :brand_id, options_from_collection_for_select( Brand.order('name ASC'), :id, :name ), onchange: 'brandOnChangeHandler( this )', include_blank: true %>
  </div>
  <div class="form-group">
    <%= f.label :brand_model_id, 'Modell', class: 'col-md-3' %>
    <%= f.collection_select :brand_model_id, BrandModel.order('name ASC'), :id, :name %>
  </div>
  <div class="form-group">
    <%= f.label :color_code, 'Farb-Code', class: 'col-md-3' %>
    <%= f.text_field :color_code, class: 'col-md-3' %>
  </div>
  <div class="form-group">
    <%= f.label :car_brand_id, 'Fahrzeug-Id', class: 'col-md-3' %>
    <%= f.text_field :car_brand_id, class: 'col-md-3' %>
  </div>
  <div class="form-group">
    <%= f.label :car_type, 'Typ', class: 'col-md-3' %>
    <%= f.text_field :car_type, class: 'col-md-3' %>
  </div>
  <div class="form-group">
    <%= f.label :power, 'kW', class: 'col-md-3' %>
    <%= f.number_field :power %>
  </div>
  <div class="form-group">
    <%= f.label :date_of_construction, 'Konstruktionsdatum', class: 'col-md-3' %>
    <%= f.date_field :date_of_construction, :include_blank => true %>
  </div>
  <div class="form-group">
    <%= f.label :month_of_construction_period_from, 'Herstellungszeitraum von/bis', class: 'col-md-3' %>
    <%= f.select :month_of_construction_period_from, 1..12, :selected => f.object.month_of_construction_period_from, :include_blank => true %>
    <%= f.select :year_of_construction_period_from, 1900..Time.now.year, :selected => f.object.year_of_construction_period_from, :include_blank => true %>
    /
    <%= f.select :month_of_construction_period_to, 1..12, :selected => f.object.month_of_construction_period_to, :include_blank => true %>
    <%= f.select :year_of_construction_period_to, 1900..Time.now.year, :selected => f.object.year_of_construction_period_to, :include_blank => true %>
  </div>
  <div class="form-group">
    <%= f.label :cylinder_capacity, 'Hubraum in ccm', class: 'col-md-3' %>
    <%= f.number_field :cylinder_capacity %>
  </div>
  <div class="form-group">
    <%= f.label :fuel, 'Kraftstoff', class: 'col-md-3' %>
    <%= f.select :fuel, options_for_select( Car::FUEL_TYPES, f.object.fuel ) %>
  </div>
  <div class="form-group">
    <%= f.label :car_type, 'Motorcode', class: 'col-md-3' %>
    <%= f.text_field :engine_code, class: 'col-md-3' %>
  </div>
  <div class="form-group">
    <%= f.label :gearing, 'Getriebe', class: 'col-md-3' %>
    <%= f.select :gearing, options_for_select( Car::GEARING_TYPES, f.object.gearing ) %>
  </div>
  <div class="form-group">
    <%= f.label :gearing_code, 'Getriebe-Code', class: 'col-md-3' %>
    <%= f.text_field :gearing_code %>
  </div>
  <div class="form-group">
    <%= f.label :key_number2, 'Schlüsselwert 2 3', class: 'col-md-3' %>
    <%= f.text_field :key_number2 %>
    <%= f.text_field :key_number3 %>
  </div>
  <div class="form-group">
    <%= f.label :mileage, 'Kilometerstand', class: 'col-md-3' %>
    <%= f.number_field :mileage %>
  </div>
  <div class="form-group">
    <%= f.label :picture_url, 'Url Bild', class: 'col-md-3' %>
    <%= f.url_field :picture_url%>
  </div>
  <div class="form-group">
    <%= f.label :ebay_url_all_parts, 'ebay Url "Alle Teile"', class: 'col-md-3' %>
    <%= f.url_field :ebay_url_all_parts %>
  </div>
  <div class="form-group">
    <%= f.label :name_ebay_url_all_parts, 'ebay Beschreibung "Alle Teile"', class: 'col-md-3' %>
    <%= f.text_field :name_ebay_url_all_parts %>
  </div>

  <div class="form-group">
    <%= link_to 'Abbrechen', cars_path, class: 'btn btn-default' %>
    <%= f.submit 'Speichern', class: 'btn btn-default' %>
  </div>
<% end %>

<script>
  function brandOnChangeHandler( event ) {
    var selectedBrandId = $(event).val();
    var requestForModells = '/all_models_for_brand?brand_id=' + selectedBrandId;
    var modelSelect = $( '#car_brand_model_id');
    modelSelect.empty();
    $.get( requestForModells ).done( function( result ) {
      result.forEach( function( model ) {
        modelSelect.append( new Option( model.name, model.id ) );
      } );
    } );
  }
</script>